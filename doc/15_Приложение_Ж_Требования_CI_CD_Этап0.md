# Приложение Ж
## Требования к CI/CD (Этап 0)

### 1. Назначение
Документ описывает базовые требования к процессам **непрерывной интеграции (CI)** и **непрерывной доставки/деплоя (CD)** для проекта на Этапе 0.

Цель — обеспечить повторяемую сборку, автоматические проверки и контролируемый деплой.

---

## 2. Общие принципы

- Все изменения проходят через систему контроля версий (Git).
- Каждый коммит/merge request в основные ветки (`main`, `develop`) должен сопровождаться автоматической сборкой и проверками.
- Сборка и деплой должны быть максимально автоматизированы и выполняться по понятным сценариям.

CI/CD может быть реализован на любой платформе (GitHub Actions, GitLab CI, TeamCity, Jenkins и т.д.), но требования к шагам остаются общими.

---

## 3. Процесс CI (Continuous Integration)

### 3.1 Триггеры CI

- push в ветку `main`;
- push в ветку `develop` (если используется);
- открытие/обновление merge request (pull request).

### 3.2 Шаги CI-пайплайна

**Шаг 1. Checkout кода**
- Получение актуальной версии репозитория.

**Шаг 2. Сборка backend**
- Установка SDK .NET нужной версии;
- `dotnet restore` для backend-проектов;
- `dotnet build -c Release`;

**Шаг 3. Запуск тестов backend (если есть)**
- `dotnet test` для проектов в `backend/tests`.

**Шаг 4. Сборка frontend**
- Установка Node.js LTS;
- `npm install` или `yarn install` в папке `frontend`;
- `npm run build` или эквивалентная команда.

**Шаг 5. Статический анализ (опционально)**
- использование `eslint`/`tsc --noEmit` для frontend;
- использование анализаторов кода для .NET (Roslyn Analyzers, SonarQube и т.п.).

### 3.3 Результат CI

- При успешном выполнении всех шагов — статус **passed**;
- При ошибках сборки/тестов — статус **failed** с логами;
- Результаты должны быть доступны в интерфейсе CI-системы.

---

## 4. Процесс CD (Continuous Delivery/Deployment)

### 4.1 Среды

Минимально рекомендуется иметь:
- **dev/test** — среда для разработчиков и тестирования;
- **prod** — продуктивная среда.

### 4.2 Триггеры CD

- Явный запуск пайплайна деплоя (manual/approval);
- Либо автоматический деплой в dev/test при каждом успешном CI в ветке `develop`.

### 4.3 Артефакты сборки

- Backend: собранные .NET-артефакты (публикация через `dotnet publish`);
- Frontend: статические файлы сборки (`build/`), готовые к раздаче веб-сервером.

### 4.4 Типовой сценарий деплоя

1. Получить артефакты последней успешной сборки.
2. Остановить приложение (если необходимо) или перевести трафик на другой инстанс.
3. Развернуть новые артефакты в целевой директории/контейнер.
4. Применить миграции БД (если есть новые миграции) — `dotnet ef database update`.
5. Запустить (или перезапустить) бэкенд-сервис.
6. Выполнить быстрый смоук-тест (проверка доступности `/health`, `/api/auth/login` и т.п.).

### 4.5 Требования к откату (rollback)

- Должна быть понятная процедура отката на предыдущую версию (предыдущие артефакты и резервная копия БД);
- Перед применением миграций БД — наличие актуального бэкапа.

---

## 5. Логирование и мониторинг

- CI/CD-система должна хранить логи запусков пайплайнов (кто, когда, с каким результатом);
- Желательно иметь базовый мониторинг доступности сервиса (HTTP health-check);
- При неудачном деплое должны приходить уведомления ответственным (почта, мессенджер).

---

## 6. Требования к безопасности

- Секреты (пароли БД, ключи токенов и т.п.) не хранятся в Git, а задаются через переменные окружения/секрет-хранилища CI/CD;
- Доступ к пайплайнам деплоя на prod ограничен (только для ответственных лиц);
- Все изменения на prod фиксируются (кто инициировал деплой, на какую версию).

---

## 7. Итог

Реализация описанных процессов CI/CD на Этапе 0 позволит:
- автоматически проверять корректность сборки и базовые тесты при каждом изменении кода;
- безопасно и воспроизводимо выкатывать новые версии приложения;
- снизить риски человеческого фактора при деплое и упростить сопровождение системы.

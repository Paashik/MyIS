# Приложение Г
## Модель данных users/roles (Этап 0)

### 1. Назначение документа
Документ описывает модель данных, реализуемую в рамках Этапа 0 и предназначенную для обеспечения аутентификации и ролевой авторизации пользователей системы.

Она является фундаментом, на котором будут строиться механизмы безопасности всех последующих модулей.

---

## 2. Общие требования
- БД: PostgreSQL.
- Все идентификаторы — **UUID (uuid_generate_v4)**.
- Все временные поля — в формате **timestamptz**.
- Пароли хранятся только в виде **хешей** (bcrypt или Argon2).
- Таблицы располагаются в схеме **core** (или другой, согласованной заранее).

---

# 3. Структура таблиц

## 3.1 Таблица `users`

### Назначение
Хранит учетные записи пользователей системы.

### Структура
| Поле | Тип | Описание |
|------|------|-----------|
| id | uuid (PK) | Уникальный идентификатор пользователя |
| login | text (unique) | Логин |
| password_hash | text | Хеш пароля |
| full_name | text | Полное имя пользователя |
| is_active | boolean | Активен ли пользователь |
| created_at | timestamptz | Дата создания |
| updated_at | timestamptz | Дата обновления |

### Ограничения
- Уникальность логина.
- Нельзя удалить пользователей, участвующих в системных процессах (исполняется на уровне приложения).

---

## 3.2 Таблица `roles`

### Назначение
Справочник ролей системы.

### Структура
| Поле | Тип | Описание |
|------|------|-----------|
| id | uuid (PK) | Уникальный идентификатор роли |
| code | text (unique) | Код роли (ADMIN, USER и др.) |
| name | text | Человекочитаемое название роли |
| created_at | timestamptz | Когда создана запись |

### Примеры ролей
| code | name |
|-------|------------|
| ADMIN | Администратор |
| USER | Пользователь |

---

## 3.3 Таблица `user_roles`

### Назначение
Связь пользователей с ролями (многие-ко-многим).

### Структура
| Поле | Тип | Описание |
|------|------|-----------|
| user_id | uuid (FK) | Пользователь |
| role_id | uuid (FK) | Роль |
| assigned_at | timestamptz | Момент присвоения роли |

### Ограничения
- (user_id, role_id) — составной первичный ключ.
- ON DELETE CASCADE.

---

# 4. Дополнительные требования

## 4.1 Аудит
Для users и user_roles обязательны:
- created_at,
- updated_at (только users),
- assigned_at.

## 4.2 Seed-данные
При создании базы должны быть автоматически добавлены:

### Роли
- ADMIN
- USER

### Пользователь ADMIN
| Поле | Значение |
|-------|----------|
| login | admin |
| full_name | Администратор системы |
| password_hash | задаётся при деплое |
| роль | ADMIN |

## 4.3 Требования к паролям
- минимальная длина: 8 символов;
- обязательная проверка сложности (на уровне приложения);
- хранение только хешей.

---

# 5. Связи между сущностями
```text
users (1) —— (*) user_roles (*) —— (1) roles
```

---

# 6. Требования к миграциям
- Все изменения выполняются через EF Core Migrations;
- Каждая миграция должна иметь осмысленное имя;
- При изменении таблиц users или roles пересоздание запрещено — только ALTER.

---

# 7. Итог
Модель данных Этапа 0 обеспечивает:
- регистрацию пользователей;
- назначение ролей;
- аутентификацию;
- ролевое управление доступом к модулям и меню.

На основе этой модели строится авторизация на сервере и отображение пунктов меню на клиентской части.

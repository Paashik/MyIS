# Приложение Д
## API Login/Auth (Этап 0)

### 1. Назначение
Приложение описывает базовые конечные точки (endpoints) API аутентификации и получения информации о текущем пользователе, реализуемые на Этапе 0.

API предназначено для использования клиентским SPA-приложением (React + Ant Design).

---

## 2. Общие положения

- Стиль API: **REST/JSON**.
- Базовый URL API: `/api/`.
- Формат данных: JSON, UTF-8.
- Ошибки возвращаются в виде JSON-объекта с полями:
  - `code` — строковый или числовой код ошибки;
  - `message` — человекочитаемое сообщение;
  - опционально `details`.

Вариант авторизации на Этапе 0:
- cookie-based auth (аутентификационный cookie ASP.NET Core) **ИЛИ** JWT Bearer Token — выбирается на этапе реализации, но контракты остаются аналогичными.

---

## 3. Endpoint: POST /api/auth/login

### 3.1 Назначение
Аутентификация пользователя по логину и паролю.

### 3.2 Запрос
**Метод:** `POST`

**URL:** `/api/auth/login`

**Тело запроса (JSON):**
```json
{
  "login": "user1",
  "password": "Pa$$w0rd"
}
```

### 3.3 Ответ при успешной аутентификации

**Код ответа:** `200 OK`

**Тело ответа (JSON):**
```json
{
  "user": {
    "id": "uuid",
    "login": "user1",
    "fullName": "Иванов Иван Иванович",
    "roles": ["ADMIN", "USER"]
  }
}
```

- В случае cookie-based auth — в ответе устанавливается аутентификационный cookie.
- В случае JWT — может дополнительно возвращаться поле `token`:
```json
{
  "token": "<jwt-token>",
  "user": { ... }
}
```

### 3.4 Ошибки

#### Неверные логин или пароль
- **Код:** `401 Unauthorized`
- **Тело:**
```json
{
  "code": "INVALID_CREDENTIALS",
  "message": "Неверный логин или пароль"
}
```

#### Заблокированный пользователь
- **Код:** `403 Forbidden`
- **Тело:**
```json
{
  "code": "USER_BLOCKED",
  "message": "Учетная запись заблокирована"
}
```

---

## 4. Endpoint: POST /api/auth/logout

### 4.1 Назначение
Завершение сессии пользователя.

### 4.2 Запрос
**Метод:** `POST`

**URL:** `/api/auth/logout`

Тело запроса — пустое.

### 4.3 Ответ
- **Код:** `200 OK`
- **Тело (опционально):**
```json
{
  "message": "Выход выполнен"
}
```

При cookie-based auth — сервер сбрасывает/делает недействительным аутентификационный cookie.
При JWT — на стороне клиента токен удаляется, опционально может использоваться blacklist/revocation на сервере.

---

## 5. Endpoint: GET /api/auth/me

### 5.1 Назначение
Получение информации о текущем аутентифицированном пользователе.

### 5.2 Запрос
**Метод:** `GET`

**URL:** `/api/auth/me`

### 5.3 Ответ при успехе

**Код:** `200 OK`

**Тело:**
```json
{
  "id": "uuid",
  "login": "user1",
  "fullName": "Иванов Иван Иванович",
  "roles": ["ADMIN", "USER"]
}
```

### 5.4 Ошибки

#### Неаутентифицированный пользователь
- **Код:** `401 Unauthorized`
- **Тело:**
```json
{
  "code": "UNAUTHORIZED",
  "message": "Требуется аутентификация"
}
```

---

## 6. Требования к безопасности

- Пароль должен передаваться только по защищённому каналу (HTTPS) в боевом контуре.
- При нескольких неудачных попытках входа подряд может применяться блокировка (логика уточняется на следующих этапах).
- Все запросы к защищённым маршрутам API (кроме /login) должны проверять наличие действующей аутентификации.

---

## 7. Требования к логированию

- Успешные входы и выходы пользователей логируются (userId, время, IP-адрес — при необходимости).
- Неуспешные попытки входа также логируются с указанием логина и причины (без сохранения пароля).
- Логи должны позволять проводить служебное расследование в случае инцидентов безопасности.

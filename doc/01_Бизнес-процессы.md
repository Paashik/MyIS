# 6. Ключевые бизнес-процессы вокруг заявок (целевое видение)

Ниже — целевые схемы «как должно быть». Детализация до шагов/ролей может быть вынесена в отдельные BPM-диаграммы.

## 6.1. Заявка на разработку / разработку+изготовление

**Цель:** получить управляемый процесс от входящего запроса до принятия решения и запуска работ (заказа клиента и связанных внутренних заказов/заявок).

Кратко:

1. Поступает заявка (от головного / внешнего заказчика).
2. Инициатор регистрирует её в модуле `Requests` (статус: Черновик → На согласовании).
3. Согласование:

   * руководитель подразделения — целесообразность;
   * инженерный блок — реализуемость, объём работ;
   * при необходимости — предварительная оценка сроков/стоимости.
4. При согласовании:

   * модуль `Customers` создаёт **заказ клиента на разработку**;
   * модуль `Engineering`:

     * резервирует или создаёт новую позицию изделия;
     * планирует ревизию/спецификацию.
5. Заявка переходит в статус **Согласована** → **В работе**.
6. По завершении работ (разработка/изготовление/поставка) — статус **Закрыта**.

## 6.2. Заявка на изготовление изделий

**Цель:** управляемо запустить производство по уже определённому изделию/ревизии.

Кратко:

1. Инициатор (головное или внешнее лицо через менеджера) оформляет запрос на изготовление.
2. Заявка регистрируется (с указанием изделия, объёма, сроков).
3. Согласование:

   * проверка загрузки производства;
   * проверка доступности комплектующих (через `Warehouse` и/или `Procurement`).
4. При согласовании:

   * в модуле `Production` создаётся **производственный заказ и партии**;
   * заявка связывается с соответствующим заказом клиента.
5. Заявка → **Согласована** → **В работе** (идёт производство).
6. После отгрузки/закрытия производственных заказов — заявка → **Закрыта**.

## 6.3. Заявка на закупку под заказ клиента

**Цель:** обеспечить прозрачный цикл «потребность → согласование → выбор маршрута закупки → заказы поставщикам → приход на склад» с сохранением информации о том, что, где, когда и по какой цене закупалось.

1. На основании заказа клиента (из Компонента или модуля `Customers`) создаётся **Заявка на обеспечение / закупку** в `Requests`:

   * перечень нужных комплектующих/материалов/услуг;
   * привязка к заказу клиента/изделию/партии;
   * предварительно выбираются адресат и маршрут закупки (через головное предприятие или прямая закупка подразделением).

2. На этапе согласования заявки:

   * уточняется состав и количества;
   * проверяются складские остатки/резервы (`Warehouse`);
   * принимается решение по маршруту закупки (оставить через головное предприятие или разрешить прямую закупку подразделением);
   * при необходимости может инициироваться согласование условий закупки с головным предприятием (во внутреннем процессе или через внешнюю BPM-систему).

Дальнейшая цепочка зависит от выбранного маршрута закупки.

**Сценарий 1. Закупка через головное предприятие**

3. Согласованная заявка с маршрутом «через головное предприятие» передаётся в модуль `Procurement` и далее — в головное предприятие (через `Integration.Component2020` или другой согласованный канал). Детализированная структура доступов Компонент‑2020, задействованная в интеграции, приведена в [Component2020_Access_schema_mermaid.md](../.kilocode/rules/Component2020_Access_schema_mermaid.md).

4. Головное предприятие:

   * запрашивает и получает коммерческие предложения/счета у внешних поставщиков;
   * заключает договоры и оплачивает счета;
   * возвращает в подразделение информацию о выбранных поставщиках, ценах и условиях (копии КП/счётов).

5. В `Procurement` на основании полученной информации создаются **Заказы поставщикам** на реальных контрагентов с признаком маршрута «через головное предприятие» и плательщиком «головное предприятие». Заявка на обеспечение связывается с соответствующими заказами поставщикам.

6. При поступлении комплектующих/материалов:

   * в `Warehouse` оформляется приход на склад с привязкой к заказу поставщику и исходной заявке;
   * первичные документы (накладные, УПД и т.п.), если они попадают в подразделение, регистрируются в Системе по реквизитам и передаются в головное предприятие для бухгалтерской обработки;
   * статусы заявок и заказов поставщикам обновляются.

**Сценарий 2. Прямая закупка подразделением**

3'. Согласованная заявка с маршрутом «прямая закупка» обрабатывается в `Procurement` как инициатива на прямой контакт с поставщиками от имени подразделения.

4'. `Procurement`:

* запрашивает коммерческие предложения и/или счета у внешних поставщиков;
* при необходимости инициирует согласование условий закупки с головным предприятием (например, через внешний BPM-процесс);
* по результатам согласования выбирает поставщиков по позициям.

5'. На основании согласованных счётов в `Procurement` создаются **Заказы поставщикам**:

* с реальными поставщиками;
* с признаком маршрута «прямая закупка подразделением» и плательщиком «головное предприятие»;
* с привязкой к исходной Заявке на обеспечение и заказу клиента/партии.

6'. При поступлении комплектующих/материалов:

* подразделение получает товар и первичные документы (накладные, УПД, акты);
* в `Warehouse` оформляется приход на склад с указанием реквизитов первичных документов и связью с заказом поставщику;
* сами первичные документы передаются в головное предприятие для оплаты и бухгалтерского учёта;
* статусы заявок и заказов поставщикам обновляются до «исполнено/закрыто».

## 6.4. Диспетчеризация и контроль исполнения

**Цель:** обеспечить актуальное представление статусов и оперативный контроль исполнения заявок, заказов, закупок и производственных задач.

Кратко:

1. Модуль `Requests` собирает и отображает сводные статусы по цепочке «заявка → заказ клиента → закупка → производство → склад».
2. Модуль `Production` предоставляет информацию о ходе выполнения производственных заказов и партий (план/факт, текущая стадия, отклонения по срокам).
3. Модуль `Procurement` предоставляет статусы по заказам поставщикам и ожидаемым поставкам.
4. Модуль `Warehouse` предоставляет данные по фактическим остаткам, резервам и ключевым движениям.
5. На основе этих данных диспетчер/руководитель может:

   * выявлять просроченные и рисковые объекты (заявки, заказы, партии);
   * менять приоритеты и перераспределять ресурсы;
   * инициировать корректирующие действия (дополнительные заявки, перенос сроков, перераспределение заказов между контрагентами и т.п.).

## 6.5. Процесс разработки и постановки изделия на производство

**Цель:** обеспечить управляемый и прослеживаемый переход изделия от стадии идеи/разработки до освоенного мелкосерийного производства без введения отдельной сущности «проект» в Системе.

Процесс рассматривается как последовательность стадий жизненного цикла изделия и технологии, реализуемых через существующие объекты Системы:

* заявки (заявка заказчика, заявки на изменение, внутренние производственные заявки, заявки на внешний технологический этап, заявки на обеспечение/закупку);
* заказы клиентов и производственные заказы;
* изделия и их ревизии в домене `Engineering`;
* маршруты и техпроцессы в домене `Technology`.

### 6.5.1. Стадии жизненного цикла изделия и технологии

Для каждой ревизии изделия в `Engineering` и связанного маршрута в `Technology` в Системе фиксируются стадии готовности, например:

* для изделия:

  * «Разработка»;
  * «Опытные образцы»;
  * «Опытная партия / отработка технологии»;
  * «Освоенное мелкосерийное производство»;

* для техпроцесса:

  * «Черновой маршрут»;
  * «Маршрут для опытных образцов»;
  * «Маршрут для опытной партии»;
  * «Утверждённый маршрут для мелкосерийки».

Переход между стадиями осуществляется по результатам выполнения связанных работ и оформляется ответственными лицами (конструктор, технолог, руководитель).

### 6.5.2. Основные этапы процесса (сквозной сценарий)

1. **Инициация разработки**

   * Поступает Заявка заказчика (на разработку или разработку+изготовление).
   * В `Customers` создаётся соответствующий заказ клиента.
   * В `Engineering` заводится изделие/ревизия со стадией «Разработка».

2. **Разработка и уточнение требований**

   * В `Engineering` выполняется разработка КД, формирование первоначальной спецификации (BOM).
   * При необходимости оформляются Заявки на изменение (уточнение требований, замена компонентов и т.п.).
   * Стадия изделия остаётся «Разработка».

3. **Опытные образцы**

   * Оформляется Внутренняя производственная заявка на изготовление опытных образцов.
   * Создаётся производственный заказ в `Production`, при необходимости — Заявки на внешний технологический этап (платы, детали, покрытия) и Заявки на обеспечение/закупку.
   * По результатам испытаний изделий и анализа проблем могут подаваться дополнительные Заявки на изменение.
   * После успешных испытаний стадия изделия переводится в «Опытные образцы».

4. **Опытная партия / отработка технологии**

   * Оформляется новая Внутренняя производственная заявка на опытную/установочную партию (например, 10–50 шт.).
   * В `Technology` уточняется маршрут и нормы, при необходимости в него вносятся изменения через Заявки на изменение.
   * В `Production` выполняется партия с контролем по ключевым параметрам (качество, трудоёмкость, узкие места).
   * По результатам отработки технологии принимается решение о готовности к мелкосерийному производству, стадия изделия меняется на «Опытная партия / отработка технологии» или «Освоенное мелкосерийное производство».

5. **Постановка на мелкосерийное производство**

   * Маршрут и техдокументация в `Technology` переводятся в статус «Утверждённый маршрут для мелкосерийки».
   * Изделие в `Engineering` переводится в стадию «Освоенное мелкосерийное производство».
   * Дальнейшие заказы клиентов по данному изделию обрабатываются как обычные заказы с использованием утверждённых КД/ТД, при этом изменения вносятся только через Заявки на изменение.

### 6.5.3. Роль заявок и диспетчеризации

На всём протяжении процесса разработки и постановки изделия используются стандартные типы заявок:

* Заявка заказчика — инициирует работы по новому изделию;
* Заявки на изменение — фиксируют и контролируют изменения КД/ТД, состава изделия и маршрутов;
* Внутренние производственные заявки — оформляют изготовление опытных образцов и опытных партий;
* Заявки на внешний технологический этап — обеспечивают взаимодействие с контрагентами по платам, деталям, покрытиям и другим внешним операциям;
* Заявки на обеспечение/закупку — закрывают потребность в материалах, комплектующих и оснастке.

Модуль `Requests` и средства диспетчеризации обеспечивают:

* сквозную видимость статусов заявок и связанных с ними заказов по конкретному изделию/ревизии;
* контроль ключевых вех (получение опытных образцов, завершение опытной партии, изменение стадии изделия);
* возможность оперативно выявлять узкие места (задержки по КД, поставкам, внешним техэтапам, производственным заказам).

Такое представление позволяет явно описать процесс разработки и постановки изделия на производство в терминах Системы, использовать существующие сущности (заявки, заказы, изделия, маршруты) без введения отдельной сущности «проект» и сохранить возможность в будущем добавить интеграцию с внешними проектными методиками, если это потребуется.

## 6.6. Планирование производства и загрузки

**Цель:** обеспечить реалистичный и управляемый план запуска и выполнения производственных заказов с учётом ограниченной мощности подразделения, доступности материалов и сроков по заказам клиентов.

Кратко:

1. На основе заказов клиентов (`Customers`), внутренних производственных заявок (`Requests`) и потребности на пополнение склада формируется перечень требуемых производственных заказов.
2. Для каждого изделия/ревизии используются маршруты и нормы времени из `Technology` для оценки трудоёмкости по операциям и участкам.
3. В модуле `Production` создаются/уточняются производственные заказы и партии, им назначаются плановые даты запуска и завершения, при необходимости — приоритет.
4. Система рассчитывает укрупнённую загрузку ключевых участков/оборудования по интервалам (день/неделя) и подсвечивает перегрузки.
5. Диспетчер/руководитель корректирует план (переносит даты, меняет размер партий, маршруты, приоритеты) с учётом:

   * доступности материалов и комплектующих (`Warehouse`, `Procurement`);
   * обязательных сроков по заказам клиентов;
   * ограничений по людям и оборудованию.
6. В ходе исполнения:

   * статусы производственных заказов и партий обновляются в `Production`;
   * план-факт по срокам и загрузке отображается на экранах диспетчеризации.

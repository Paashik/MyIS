# Техническое задание
## Этап 1. Модуль Requests (управление заявками)

### 1. Общие сведения

#### 1.1. Основание для разработки

Настоящее техническое задание (далее — ТЗ) разработано на основании документа
«Концепция Новой ИС Подразделения» и определяет требования к реализации Этапа 1 — модуля управления заявками (`Requests`) в составе Системы.

Этап 1 является стартовым этапом проекта и закладывает фундамент для последующих этапов развития Системы.

#### 1.2. Заказчик и исполнитель

- **Заказчик:** обособленное подразделение по разработке и производству СВЧ-модулей.  
- **Исполнитель:** определяется отдельно (внутренняя команда разработки или внешний подрядчик).

#### 1.3. Назначение Этапа 1

Назначение Этапа 1 — создать и ввести в эксплуатацию модуль `Requests`, обеспечивающий:

- единый входной контур для всех основных типов заявок подразделения;
- управление жизненным циклом заявок (создание, согласование, исполнение, закрытие);
- базовую интеграцию с Компонент-2020 (подтягивание справочников и заказов клиентов, формирование упрощённых заказов поставщикам на основании заявок на обеспечение/закупку);
- основу для последующего расширения функциональности (заказы клиентов, закупка, производство, склад) без необходимости пересмотра ключевых решений, принятых на Этапе 1.

#### 1.4. Связь с другими документами

К Этапу 1 относятся и должны учитываться следующие документы:

- «Концепция Новой ИС Подразделения»;  
- «Бизнес-процессы новой информационной системы подразделения»;  
- дополнительные документы, утверждённые Заказчиком (модель данных Этапа 1, макеты пользовательского интерфейса и др.), по мере их появления.

---

### 2. Цели и область охвата Этапа 1

#### 2.1. Цели Этапа 1

- Ввести модуль `Requests` как **единую точку входа** для основных типов заявок подразделения.  
- Обеспечить **прозрачный жизненный цикл** заявок (статусы, согласования, история изменений).  
- Обеспечить **базовую интеграцию** с Компонент-2020 для работы с заявками (подтягивание заказов клиентов и номенклатуры/комплектующих, формирование упрощённых заказов поставщикам по заявкам на обеспечение/закупку).  
- Сформировать **фундамент для последующих этапов**, исключив необходимость кардинальной переработки модуля `Requests` при вводе модулей `Customers`, `Procurement`, `Production`, `Warehouse`.

#### 2.2. Входит в объём работ Этапа 1

В рамках Этапа 1 подлежат реализации:

- базовая модель данных для заявок и связанных сущностей в БД PostgreSQL;  
- серверная часть модуля `Requests` (backend-логика, REST API);  
- веб-интерфейс для работы с заявками (создание, просмотр, согласование, изменение статусов);  
- поддержка следующих типов заявок (согласно концепции):
  - Заявка заказчика;  
  - Внутренняя производственная заявка;  
  - Заявка на обеспечение / закупку;  
  - Заявка на внешний технологический этап;  
  - Заявка на изменение;  
- базовая интеграция с Компонент-2020 для:
  - чтения заказов клиентов;  
  - чтения справочников номенклатуры/комплектующих;  
  - формирования и передачи в Компонент упрощённых заказов поставщикам по согласованным заявкам на обеспечение/закупку (без сложной логики выбора поставщиков внутри Системы).

#### 2.3. Не входит в объём работ Этапа 1

В рамках Этапа 1 не реализуются:

- полноценное управление заказами клиентов (будет реализовано на Этапе 2);  
- полноценный закупочный контур:
  - выбор поставщиков по критериям,  
  - детальный учёт и сравнение коммерческих предложений,  
  - сложные схемы согласования закупок;  
- производственный контур (подробный учёт операций, статусов по операциям, маршрутов) и расширенный складской функционал (Этап 3);  
- полный перенос инженерных и технологических данных (Этап 4);  
- интеграция с внешними BPM-системами (на Этапе 1 допускается только задел в виде событий/хуков без реализации конкретных BPM-процессов);  
- сервисные заявки / рекламации (поддержка этого типа заявок будет уточняться в рамках последующих этапов).

---

### 3. Описание функциональных требований

#### 3.1. Типы заявок и общие атрибуты

Система должна поддерживать работу с типами заявок, указанными в п. 2.2 и глоссарии (п. 4.7 Концепции).

Для всех типов заявок вводится **общий набор базовых атрибутов**, включая, но не ограничиваясь:

- идентификатор заявки;  
- тип заявки;  
- источник (головное предприятие / внешний заказчик / внутренний инициатор);  
- адресат (подразделение / головное предприятие / внешний поставщик/подрядчик);  
- объект (изделие, партия, материалы/комплектующие, услуги, документация, технологический этап);  
- цель (разработка, изготовление, обеспечение/закупка, внешний технологический этап, изменение);  
- статус;  
- инициатор;  
- даты и время создания, последнего изменения, отправки на согласование, согласования/отклонения;  
- приоритет (опционально).

Для каждого типа заявки должны быть определены **дополнительные специфические атрибуты** (например: привязка к заказу клиента, изделию/ревизии, партии, внешнему контрагенту и т.п.). Состав этих атрибутов фиксируется в отдельном документе «Модель данных Этапа 1 (модуль Requests)».

#### 3.2. Жизненный цикл заявки (статусы и переходы)

Для большинства типов заявок используется следующий базовый набор статусов:

- Черновик;  
- На согласовании;  
- Согласована;  
- В работе;  
- Закрыта;  
- Отклонена.

Требования:

- должна быть реализована **базовая схема переходов** между статусами (Черновик → На согласовании → Согласована → В работе → Закрыта / Отклонена и т.п.);  
- для разных типов заявок допускаются **ограничения и отличия** в возможных переходах (на уровне конфигурации/справочников);  
- должна вестись **история статусов** и действий пользователей (кто, когда, какой переход выполнил, с каким комментарием).

#### 3.3. Операции над заявками

Система должна обеспечивать следующие операции:

- создание заявки выбранного типа;  
- редактирование заявки в допустимых статусах (как минимум — в статусе «Черновик», при необходимости — после возврата на доработку);  
- отправка заявки на согласование;  
- согласование заявки (изменение статуса, добавление комментария);  
- отклонение заявки (с фиксацией причины);  
- перевод заявки в работу и в закрытое состояние;  
- привязка заявки к:
  - заказу клиента (при наличии),  
  - заказу поставщику (по мере появления функционала последующих этапов),  
  - производственному заказу/партии (в следующих этапах);  
- добавление и просмотр комментариев по заявке;  
- просмотр истории изменений (аудит).

#### 3.4. Представления и фильтры

Должны быть реализованы как минимум следующие представления:

- **Журнал заявок** (список) с возможностью фильтрации по:
  - типу заявки,  
  - статусу,  
  - инициатору,  
  - адресату,  
  - объекту (изделие, заказ клиента, контрагент),  
  - датам (создание, отправка на согласование, изменение статуса);  
- **Карточка заявки**:
  - все основные атрибуты заявки;  
  - история статусов и комментариев;  
  - привязанные объекты (заказ клиента, заказ поставщику, производственный заказ/партия — по мере появления);  
- базовые преднастроенные фильтры/представления для разных ролей:
  - «Мои заявки» (инициатор);  
  - «На согласовании у меня»;  
  - «Все заявки подразделения» (для руководителя).

#### 3.5. Интеграция с Компонент-2020 в рамках Этапа 1

В рамках Этапа 1 модуль `Requests` должен:

- иметь возможность **подтягивать данные** из Компонента:
  - заказы клиентов (для привязки к Заявкам заказчика и заявкам на обеспечение под заказ клиента);  
  - справочники номенклатуры/комплектующих (для Заявок на обеспечение / закупку и Заявок на внешний технологический этап);  
- обеспечивать **формирование и передачу** в Компонент упрощённых заказов поставщикам:
  - по согласованным заявкам на обеспечение / закупку;  
  - без реализации внутри Системы сложной логики выбора поставщиков (на Этапе 1 поставщик может задаваться напрямую или через простую настройку);  
  - с возможностью однозначно связать заказ поставщику в Компоненте с исходной заявкой в Системе (по идентификатору/номерному правилу).

Подробные технические требования к обмену данными с Компонентом-2020 будут оформлены в отдельном интеграционном приложении к ТЗ. Дополнительно структура доступов Компонент‑2020, на которую опирается интеграция, описана в [Component2020_Access_schema_mermaid.md](../.kilocode/rules/Component2020_Access_schema_mermaid.md).

---

### 4. Требования к данным и модели

#### 4.1. Общие требования к данным

- Данные модуля `Requests` хранятся в БД PostgreSQL в составе общей БД Системы с выделением собственного набора таблиц/схем, принадлежащих модулю.
- Для всех основных сущностей (заявка, тип заявки, статус, история статусов/согласований, связи с внешними объектами) должны использоваться устойчивые уникальные идентификаторы.
- Должна обеспечиваться референциальная целостность данных:
  - внешние ключи между заявками и связанными сущностями (тип, статус, инициатор и т.п.);
  - внешние ключи или устойчивые ссылки на внешние сущности (заказ клиента, заказ поставщику, производственный заказ), по мере их появления в Системе.
- Должны фиксироваться временные атрибуты (дата/время создания, обновления, изменения статуса, согласования/отклонения) в едином формате.
- Должна быть возможность однозначной идентификации заявок и их связи при обмене данными с Компонент-2020 (например, через согласованное правило формирования номеров или отдельное поле внешнего идентификатора).

#### 4.2. Основные сущности Этапа 1

В рамках Этапа 1 как минимум должны быть реализованы следующие сущности:

- **Заявка** — основная сущность, представляющая единицу работы/инициативы.  
- **Тип заявки** — справочник типов заявок (Заявка заказчика, Внутренняя производственная заявка, Заявка на обеспечение / закупку, Заявка на внешний технологический этап, Заявка на изменение).  
- **Статус заявки** — справочник статусов (Черновик, На согласовании, Согласована, В работе, Закрыта, Отклонена и при необходимости дополнительные).  
- **История статусов/согласований** — сущность для фиксации переходов между статусами, действий согласующих и комментариев.  
- **Связи заявки с внешними сущностями** — сущности/таблицы (или поля), обеспечивающие связь заявок с заказами клиентов, заказами поставщикам, производственными заказами и другими объектами, реализуемыми на последующих этапах.

Состав полей каждой сущности и типы данных фиксируются в отдельном документе «Модель данных Этапа 1 (модуль Requests)».

#### 4.3. Справочники и конфигурация

- Типы заявок и статусы заявок должны храниться в виде справочников.
- Должна быть предусмотрена возможность расширения справочников типов и статусов без изменения прикладного кода (через данные и конфигурацию).
- По возможности маршруты согласования (кто и в каком порядке согласует конкретный тип заявки) должны задаваться конфигурационно (минимальный уровень — закрепление ролей/должностей за типами заявок).

#### 4.4. Требования к расширяемости и миграции

- Модель данных должна допускать добавление новых полей и сущностей (новых типов заявок, дополнительных атрибутов, связей) без нарушения ранее сохранённых данных.
- Изменения структуры БД должны выполняться через систему миграций и сопровождаться документацией.
- Для отладки и приёмочных испытаний должна быть возможность формирования тестового набора данных (несколько десятков/сотен заявок разных типов и статусов).

(Подробная схема БД и описание таблиц/полей оформляются в виде отдельного приложения к ТЗ.)

---


### 5. Требования к пользовательскому интерфейсу

#### 5.1. Общие принципы

- Интерфейс модуля `Requests` должен быть максимально простым и однородным для различных типов заявок.
- Все основные операции (создание заявки, отправка на согласование, согласование/отклонение) должны выполняться в минимальное количество действий.
- Интерфейс предназначен для работы в современных браузерах на стационарных рабочих местах (ПК/ноутбуки).

Язык пользовательского интерфейса на Этапе 1 — **русский**.

#### 5.2. Основные экраны

Должны быть реализованы следующие основные экраны/представления:

- **Журнал заявок**  
  - табличное представление списка заявок;  
  - фильтры по типу, статусу, инициатору, адресату, объекту, датам;  
  - возможность сортировки по ключевым полям (дата создания, тип, статус, инициатор и т.д.);  
  - быстрые действия (открыть заявку, при наличии прав — согласовать/отклонить/вернуть).

- **Карточка заявки**  
  - форма создания/просмотра/редактирования заявки;  
  - отображение всех основных атрибутов заявки;  
  - блок истории статусов и комментариев;  
  - блок связей с внешними объектами (заказ клиента, заказ поставщику, производственный заказ/партия — по мере реализации этих сущностей в Системе).

- **Экран согласования**  
  - упрощённый экран/панель для согласующих, позволяющий быстро принять решение по заявке (согласовать, отклонить, вернуть на доработку) и оставить комментарий;  
  - возможность обработки нескольких заявок последовательно без лишних переходов.

- **Простые дашборды/счётчики**  
  - количество заявок по статусам;  
  - количество заявок «На согласовании» и «Просроченных»;  
  - при необходимости — панель для руководителя с агрегированной информацией по подразделению.

#### 5.3. Валидация и сообщения об ошибках

- Для обязательных полей должны быть реализованы проверки заполнения с понятными пользователю сообщениями об ошибках.
- При ошибках сохранения (проблемы с соединением, внутренние ошибки сервера) пользователю должна отображаться понятная информация о том, что произошло, без раскрытия технических деталей.
- Должны быть предотвращены ситуации двойного сохранения/отправки одной и той же заявки при повторном нажатии пользователем (например, через блокировку кнопки на время отправки).

#### 5.4. Роли и права в интерфейсе (на уровне требований)

- Набор доступных действий в интерфейсе должен зависеть от роли пользователя (инициатор, согласующий, руководитель и т.п.).
- Ограничения по ролям на Этапе 1 могут быть реализованы в упрощённом виде (например, по принадлежности к группе/подразделению), но должны быть учтены в архитектуре для последующего расширения.

---


### 6. Нефункциональные требования

#### 6.1. Архитектура и стек

- Модуль `Requests` реализуется как часть серверного приложения (модульный монолит) в соответствии с концепцией Системы.
- В качестве СУБД используется PostgreSQL.
- Веб-интерфейс реализуется как клиентское приложение, работающее в актуальных браузерах и взаимодействующее с сервером по HTTP(S) через REST API.

#### 6.2. Производительность и масштабируемость

- Модуль должен обеспечивать комфортную работу для типового числа пользователей подразделения (до ~20 одновременных пользователей) без заметных задержек при основных операциях (открытие журнала заявок, просмотр карточки, изменение статуса).
- Операции чтения списка заявок и карточки отдельной заявки должны выполняться за время, приемлемое для пользователя (ориентир — менее 2–3 секунд при типичных объёмах данных Этапа 1).

#### 6.3. Безопасность и права доступа

- Доступ к модулю `Requests` должен осуществляться по аутентифицированным учетным записям пользователей.
- Должна быть обеспечена базовая авторизация по ролям (минимально: разграничение прав на создание/редактирование заявок, согласование, просмотр всех заявок подразделения). Детальная модель ролей может быть уточнена в отдельном документе.
- Доступ к данным и операциям через API должен быть защищён (использование защищённого протокола при необходимости, проверка прав на серверной стороне).

#### 6.4. Логирование и аудит

- Должно вестись логирование ключевых операций:
  - создание и изменение заявок;  
  - операции, связанные с отменой/архивированием заявок (если такие операции будут предусмотрены);  
  - изменение статусов и согласование/отклонение;  
  - ошибки приложения и интеграции с Компонентом.
- Логи должны позволять восстановить ход выполнения операций при разборе инцидентов.
- История изменений по заявке (кто, когда, что изменил) должна храниться на уровне данных модуля `Requests` и быть доступна для просмотра уполномоченным пользователям.

#### 6.5. Резервное копирование и восстановление

- Данные модуля `Requests` включаются в общую стратегию резервного копирования БД Системы.
- Требования к периодичности резервного копирования и времени восстановления согласуются с общими требованиями к Системе и инфраструктуре Заказчика.

---


### 7. Этапы реализации внутри Этапа 1 (итерации)

Планируется поэтапная реализация функциональности модуля `Requests` с возможностью уточнения состава работ по результатам согласования между Заказчиком и Исполнителем.

#### 7.1. Итерация 1. Базовая модель и API

- Реализация сущности «Заявка», справочников типов и статусов.  
- Реализация базовых CRUD-операций и простого жизненного цикла (Черновик → На согласовании → Согласована → В работе → Закрыта).  
- Реализация простого веб-интерфейса для создания и просмотра заявок.

#### 7.2. Итерация 2. Согласование и история

- Реализация маршрутов согласования в минимально необходимом объёме.  
- Реализация истории изменений и комментариев по заявкам.  
- Улучшение журналов и фильтров, добавление представлений «Мои заявки», «На согласовании у меня» и т.п.

#### 7.3. Итерация 3. Интеграция с Компонент-2020

- Подключение к базе данных Компонента через модуль интеграции.  
- Подтягивание заказов клиентов и номенклатуры/комплектующих в формы заявок.  
- Реализация формирования упрощённых заказов поставщикам в Компонент по согласованным заявкам на обеспечение/закупку с сохранением связей между объектами.

#### 7.4. Итерация 4. Завершение и подготовка к Этапу 2

- Уточнение и доработка интерфейсов по результатам опытной эксплуатации.  
- Добавление базовых отчётов/дашбордов по заявкам (по типам, статусам, инициаторам).  
- Подготовка расширений и точек интеграции для дальнейшей работы модулей `Customers`, `Procurement`, `Production` с модуля `Requests`.

Состав и сроки итераций уточняются в рабочем порядке и фиксируются в планах-графиках работ.

---


### 8. Приложения

- **Приложение А.** «Концепция Новой ИС Подразделения» — базовый документ, описывающий общие цели, архитектуру и принципы построения Системы.  
- **Приложение Б.** «Бизнес-процессы новой информационной системы подразделения» — документ с детализированным описанием ключевых бизнес-процессов, которые поддерживаются Системой.  
- **Приложение В.** «Модель данных Этапа 1 (модуль Requests)» — формализованное описание структуры БД (таблицы, поля, связи), необходимой для реализации требований настоящего ТЗ.  
- **Приложение Г.** «Макеты пользовательского интерфейса (эскизы экранов)» — наброски и/или прототипы экранных форм, согласованные с Заказчиком и используемые Исполнителем при реализации интерфейса.

При необходимости перечень приложений может быть расширен (например, за счёт добавления интеграционных спецификаций по обмену с Компонент-2020).
